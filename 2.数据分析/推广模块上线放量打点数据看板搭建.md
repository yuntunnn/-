---
name: promotion-funnel-analysis
description: 分析推广模块放量过程中的埋点数据，生成交互式可视化分析看板（HTML）。当用户提供 App 推广弹窗、智能推荐、开屏广告等推广模块的埋点数据（含 start、pop_show、pop_click、down_start、down_end_suc 等事件）时，使用此 skill 进行漏斗分析、趋势分析和关键洞察提取，并输出可下载的 HTML 看板。触发关键词：埋点数据分析、推广漏斗、弹窗转化、放量分析、打点数据、smart_recommend、推广看板。
---

# 推广模块放量埋点分析 Skill

## 适用场景

用户提供推广模块上线以来（或某时段内）的埋点数据，通常为 CSV 或表格形式，字段包含：
- **日期**：按天的数据粒度
- **Action（事件名）**：如 start、promotion_trigger、pop_show、pop_click、down_start、down_suc、down_end_suc、down_end_fail、down_fail、break、pop_close、pop_notips、kk_pop_timeout 等
- **次数**：事件触发总次数
- **人数**：触发该事件的去重用户数

目标：输出一份完整的、可交互的 HTML 数据看板，涵盖漏斗分析、每日趋势、关键洞察与优化建议。

---

## 第一步：理解数据结构

拿到数据后，先完成以下分析：

### 1.1 识别漏斗链路
将所有 Action 映射到两条标准链路：

**主漏斗链路：**
```
start → promotion_trigger → pop_show → pop_click → down_start → down_suc/down_fail → down_end_suc/down_end_fail
```

**弹窗关闭行为链路（并联）：**
```
pop_show → pop_close（主动关闭）
         → kk_pop_timeout（超时关闭）
         → pop_notips（不再提示）
         → break（中断退出）
```

如果业务方使用不同的事件名，按语义归类到对应节点即可。

### 1.2 识别运营阶段
根据每天的 start 量级，将数据划分为阶段（示例分法）：

| 阶段 | 特征 |
|------|------|
| 灰测期 | 日启动量 < 500，用户为白名单，数据不具代表性 |
| 灰度扩量 | 日启动量快速增长，从百级到万级 |
| 稳定期 | 日启动量相对平稳（波动 <30%） |
| 正式放量 | 日启动量再次大幅提升（>50% 增长） |

> ⚠️ 灰测期数据（尤其 CTR）通常异常偏高，分析全局均值时应排除或标注。

### 1.3 计算关键指标
每天计算以下转化率：

```
弹窗展示率   = pop_show / start
弹窗 CTR     = pop_click / pop_show   ← 最关键指标，通常是最大瓶颈
下载发起率   = down_start / pop_click
下载成功率   = down_suc / down_start
安装成功率   = down_end_suc / down_start（或 down_suc）
点击→安装率  = down_end_suc / pop_click
break 率     = break / start
```

---

## 第二步：生成 HTML 看板

按以下结构生成一个完整的单文件 HTML 看板，使用纯 SVG + JavaScript 绘图（无需外部图表库）。

### 2.1 看板整体结构

```
├── 顶部 Header：标题、数据周期、整体 KPI 摘要
├── 核心 KPI 卡片区（5个）：总启动、总展示、总点击、总安装、总 break
├── 每日流量趋势图（SVG 柱状 + 折线混合）
├── 每日 CTR 趋势图（面积折线图，标注 1% 参考线）
├── 点击→安装转化率图（柱状图，颜色编码好/中/差）
├── 全周期汇总漏斗（水平条形图，各步骤带转化率标注）
├── 弹窗关闭行为分布（水平条形图）
├── 每日明细数据表（含阶段标签、条件颜色）
├── 关键洞察卡片区（3–6张）
└── 优化建议区（按优先级排列）
```

### 2.2 视觉设计规范

使用暗色主题，以下 CSS 变量为基准：

```css
--bg: #07090d;
--surface: #0e1117;
--surface2: #151820;
--border: #1a1f2c;
--c1: #3b82f6;    /* 蓝色 - start/流量 */
--c2: #8b5cf6;    /* 紫色 - pop_show */
--c3: #10b981;    /* 绿色 - 点击/成功 */
--c4: #f59e0b;    /* 琥珀 - 安装/中间指标 */
--c5: #ef4444;    /* 红色 - 失败/异常 */
--text: #e2e8f0;
--muted: #4b5563;
```

字体：`IBM Plex Mono`（数字/标签）+ `Sora` 或 `Noto Sans SC`（正文）

### 2.3 SVG 图表绘制要点

**趋势图（混合柱状+折线）：**
- 柱子：start（蓝色）、pop_show（紫色）并排
- 折线：pop_click × N 倍放大（绿色），便于在大量级下观察小量级趋势
- 阶段用背景色块区分
- X 轴为日期标签，Y 轴为量级（K 为单位）

**CTR 折线图：**
- 面积折线，填充渐变
- 画 1% 参考线（虚线）
- 每个点标注具体数值
- 灰测期数据点用不同样式标注（或说明排除）

**安装率柱状图：**
- 颜色编码：≥80% 绿色，60–79% 琥珀，<60% 红色
- 每柱顶部标注百分比

**漏斗图：**
- 水平条形图，以第一步为 100% 基准
- 每步之间标注「↓ 转化率 X%」
- 对最大流失点（通常 pop_click CTR）用高亮颜色标注

### 2.4 数据表格

表头：日期 | start | pop_show | 展示率 | pop_click | CTR | 安装成功 | 点击→安装 | break | break率 | 阶段

颜色规则：
- CTR > 2%：蓝色；CTR 1–2%：绿色；CTR < 1%：琥珀
- 安装率 ≥80%：绿色；60–79%：琥珀；<60%：红色
- break率 >20%：红色；15–20%：琥珀
- 阶段 badge：各阶段颜色与趋势图背景色块一致

---

## 第三步：关键洞察提炼

结合计算结果，从以下维度生成 3–6 条洞察卡片：

| 洞察类型 | 触发条件 | 标签颜色 |
|----------|----------|----------|
| 核心瓶颈 | CTR 始终低于 2%，无改善趋势 | 红色 |
| 流量增长 | 数据周期内 start 增幅显著 | 蓝色 |
| 亮点 | 安装成功率 >85% | 绿色 |
| 异常 | 某天流量突增/骤降超 2 倍 | 红色 |
| 关注 | break 率 >20%，累计量大 | 琥珀 |
| 趋势 | 最近 N 天持续放量 | 蓝色 |

每条洞察包含：标签、核心指标大字展示、标题、2–3 句说明。

---

## 第四步：优化建议

按优先级输出 3–5 条建议，每条包含编号、标题、说明。

**标准建议模板（根据数据动态调整）：**

1. **突破弹窗 CTR**（几乎每次都是 P0）
   - 说明具体 CTR 数值和绝对流失量
   - 建议：A/B 测试文案（利益点前置）、视觉 CTA、触发时机

2. **排查异常流量日（如有）**
   - 说明峰值日期、倍数、后续骤降情况
   - 建议：结合业务背景确认来源，评估是否可规律化

3. **治理 break 中断（如率 >15%）**
   - 说明累计量和占比
   - 建议：细化埋点区分「弹窗前/后中断」，针对性优化触发场景

4. **管理 pop_notips 用户**
   - 说明累计屏蔽人数
   - 建议：加入免推名单，分析画像

5. **下载链路补充说明（如失败率 >10%）**
   - 说明 down_fail / down_end_fail 情况
   - 建议：排查具体失败原因（网络/包损坏等）

---

## 输出规范

- 输出为**单个 HTML 文件**，所有 JS/CSS 内联，无外部依赖
- 文件保存至 `/mnt/user-data/outputs/`，用 `present_files` 工具提供下载链接
- 图表使用纯 SVG + 原生 JS 绘制，viewBox 自适应宽度
- 避免使用 ECharts / Chart.js 等外部库（网络不可用时会失败）

---

## 常见边界情况处理

| 情况 | 处理方式 |
|------|----------|
| 某天某事件数据缺失 | 该格显示 `-`，不参与均值计算 |
| 灰测期 CTR 异常高（>10%） | 表格标注「灰测」，洞察文字说明排除原因 |
| 数据只有一天 | 跳过趋势图，重点输出漏斗和关闭行为分布 |
| pop_click 为 0 的天 | 安装率显示 `-`，不绘入安装率图表 |
| 次数与人数差距大 | 在 KPI 区域额外说明「人均触发 X 次」 |
| 缺少 down_end_suc | 用 down_suc 替代作为安装成功指标 |

---

## 快速参考：指标健康度基准

| 指标 | 健康 | 需关注 | 问题 |
|------|------|--------|------|
| 弹窗展示率（pop_show/start） | >75% | 50–75% | <50% |
| 弹窗 CTR | >3% | 1–3% | <1% |
| 点击→安装率 | >85% | 70–85% | <70% |
| break 率 | <15% | 15–25% | >25% |
| 下载成功率（down_suc/down_start） | >90% | 80–90% | <80% |
